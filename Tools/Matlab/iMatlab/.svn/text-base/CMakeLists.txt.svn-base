PROJECT(iMatlab)

INCLUDE_DIRECTORIES(${VXL_INCLUDE_DIRECTORIES})
ADD_DEFINITIONS(-DMATLAB_MEX_FILE)

# use FindMatlab module in current working directory
SET( CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR} )
FIND_PACKAGE( Matlab_MOOS REQUIRED )

INCLUDE_DIRECTORIES( ${MATLAB_INCLUDE_DIR} )
LINK_DIRECTORIES(${LIBRARY_OUTPUT_PATH} ${VXLLIBDIR})
LINK_DIRECTORIES( ${MATLAB_LIBRARY_DIR} ) 

IF(WIN32)
	SET(IMATLAB_SRCS
			iMatlab.cpp
			mexVNLHelpers.cpp
			mexVNLHelpers.h
			iMatlab.def
			iMatlab.help
	   )
ELSE(WIN32)
	SET(IMATLAB_SRCS
			iMatlab.cpp
			mexVNLHelpers.cpp
			mexVNLHelpers.h)
ENDIF(WIN32)


SET( CMAKE_CXX_FLAGS ${MATLAB_CXX_FLAGS} )
ADD_LIBRARY(iMatlab MODULE ${IMATLAB_SRCS})
MESSAGE(STATUS MATLAB_MEXFILE_SUFFIX)

TARGET_LINK_LIBRARIES( iMatlab ${MATLAB_LIBRARIES} MOOS MOOSGen ${PLATFORM_LIBS} ${VNLLIBS})
SET_TARGET_PROPERTIES(iMatlab PROPERTIES
    PREFIX ""
    SUFFIX  "${MATLAB_MEX_SUFFIX}"
)

# mex copy hack ( just have to set MEX_NAME )
#SET( MEX_NAME iMatlab )
#SET( INNAME ${LIBRARY_OUTPUT_PATH}/lib${MEX_NAME}${CMAKE_SHARED_MODULE_SUFFIX} )
#SET( OUTNAME ${LIBRARY_OUTPUT_PATH}/${MEX_NAME}${MATLAB_MEX_SUFFIX} )
#MESSAGE( STATUS "Copying ${INNAME} to ${OUTNAME}")
#IF(UNIX)
#	ADD_CUSTOM_COMMAND( TARGET ${MEX_NAME} POST_BUILD 
#			COMMAND ${CMAKE_COMMAND} ARGS -E copy ${INNAME} ${OUTNAME} )
#ENDIF(UNIX)

